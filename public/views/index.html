{{ block "root" . }}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linear Regression Visualization</title>

	<!-- Pico css -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css" />

	<!-- Plotly -->
	<script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>

	<!-- Local imports -->
	<link rel="stylesheet" href="/public/styles/index.css" />
	<script src="/public/js/theme_switcher.js" defer></script>
	<script src="/public/js/linear_regression.js" defer></script>
</head>

<body>
	<!-- Header -->
	<header class="container">
		<nav>
			<ul>
				<li><strong>Linear Regression Visualization</strong></li>
			</ul>
			<ul>
				<li>
					<details class="dropdown">
						<summary role="button">Theme</summary>
						<ul>
							<li><a href="#" data-theme-switcher="auto">Auto</a></li>
							<li><a href="#" data-theme-switcher="light">Light</a></li>
							<li><a href="#" data-theme-switcher="dark">Dark</a></li>
						</ul>
					</details>
				</li>
			</ul>
		</nav>
	</header>
	<!-- ./ Header -->

	<main class="container">
		<div class="center-child">
			<div class="data-input-area">
				<textarea id="coords" placeholder="Enter coordinates" aria-describedby="valid-helper">
1,1 2,2 3,3
4,4 5,5 6,6
				</textarea>
			</div>
		</div>

		<div id="coord-box-options" class="center-child">
			<button onclick="plotData()">Plot Data</button>
			<button onclick="hideRegressionContent()">Reset</button>
		</div>

		<div id="regression-content">
			<div id="graphs">
				<div id="scatter-plot">
					<h4>Scatter Plot with Regression Line</h4>
					<div id="scatter-plot-graph"></div>
				</div>

				<div id="cost-function">
					<h4>Cost Function</h4>
					<div id="cost-function-graph"></div>
				</div>
			</div>
			<div id="graphs-side-content" class="outlined">
				<h4>How does this work?</h4>
				<label for="alpha-slider">Learning rate (Î±)</label>

				<div id="alpha-slider-container">
					<div class="range-labels">
						<span>0.05</span>
						<span id="alpha-selected-value" class="selected-value">0.1</span>
						<span>1.00</span>
					</div>
					<input type="range" id="alpha-slider" min="0.05" max="1.00" step="0.05" value="0.1"
						oninput="setLearningRate(this.value)" />
				</div>

				<div class="vertical-buttons">
					<button id="step-gradient-descent">Step gradient descent</button>
					<button id="reset-gradient-descent">Reset gradient descent</button>
				</div>

			</div>
		</div>

	</main>

</body>

<script defer>
	let learningRate = 0.1;

	function setLearningRate(r) {
		learningRate = parseFloat(r);
		document.getElementById("alpha-selected-value").innerHTML = learningRate;
	}

	function parseInput(text) {
		const regex = /\(?(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)\)?/g;
		let match, points = [];
		while ((match = regex.exec(text)) !== null) {
			points.push({x: parseFloat(match[1]), y: parseFloat(match[2])});
		}
		return points;
	}

	function validateInput(text) {
		const points = parseInput(text);
		const isValid = points.length >= 2;
		const textarea = document.getElementById("coords");
		textarea.setAttribute("aria-invalid", isValid ? "false" : "true");
		return isValid ? points : null;
	}

	function hideRegressionContent() {
		const scatterPlot = document.getElementById("regression-content");
		scatterPlot.style.display = "none";
	}

	function showRegressionContent() {
		const scatterPlot = document.getElementById("regression-content");
		scatterPlot.style.display = "flex";
	}

	function plotData() {
		const points = validateInput(document.getElementById("coords").value);

		if (points === null) {
			return;
		}

		showRegressionContent();

		const x = points.map(p => p.x);
		const y = points.map(p => p.y);

		const scatterPlot = new ScatterPlot(x, y, (plotData, _) => {
			Plotly.newPlot('scatter-plot-graph', plotData, {title: 'Scatter Plot'});
		});
		scatterPlot.render();

		const costFunctionPlot = new CostFunctionPlot(x, y, learningRate, (plotData, self) => {
			Plotly.newPlot('cost-function-graph', plotData, {title: '3D Cost Function'});

			document.getElementById('cost-function-graph').on('plotly_click', function (data) {
				const clicked_w = data.points[0].x;
				const clicked_b = data.points[0].y;
				const point = self.placeGradientPoint(clicked_w, clicked_b);
				self.render();

				if (point !== undefined) {
					scatterPlot.setRegressionLine(point.w, point.b);
					scatterPlot.render();
				}
			})

		});
		costFunctionPlot.render();


		document.getElementById('step-gradient-descent').onclick = function (data) {
			const regression = costFunctionPlot.stepGradientDescent();
			if (regression === undefined) {
				return;
			}
			costFunctionPlot.render();

			scatterPlot.setRegressionLine(regression.w, regression.b);
			scatterPlot.render();
		}

		document.getElementById('reset-gradient-descent').onclick = function (data) {
			scatterPlot.deleteRegressionLine();
			scatterPlot.render();
			costFunctionPlot.clearGradientPoints();
			costFunctionPlot.render();
		}
	}
</script>

</html>
{{ end }}
